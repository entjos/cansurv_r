melanoma_10y_spl5$haz_rcs3_1k <- melanoma_10y_spl5$haz_rcs3 * 1000
## Plot
ggplot(data = melanoma_10y_spl5, aes(x=midtime, y = haz_grp_1k)) +
geom_point()+
geom_line(data = melanoma_10y_spl5, aes(x=midtime, y = haz_rcs3_1k), color = "red") +
geom_vline(xintercept = c(1, 2, 3), linetype="dashed") +
scale_y_continuous(name="Baseline hazard (1000 pys)", breaks = c(5,10,20,50,100,150), limits = c(0, 150))+
scale_x_continuous(name="Years from diagnosis", breaks = c(2, 4, 6, 8, 10), limits = c(0, 10)) +
ggtitle("Localised skin melanoma. Plot of the estimated baseline hazard function for the piecewise
model with knots at 1, 2, and 3 years.")
## Exercise 131
## Created: 2021-06-21 Enoch Chen
## Edited:  2021-07-02 Enoch Chen
## Reference: Biostatistics III in R. https://biostat3.net/download/R/solutions/q28.html
###############################################################################
## Load the packages
library(biostat3)
library(haven)
library(dplyr)   # manipulate data
library(rstpm2)  # nsx
library(ggplot2) # ggplot
## Read data
melanoma <- read_dta("melanoma.dta")%>%
filter(stage == 1) %>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
female = ifelse(sex == 2, 1, 0), # Create a female variable
event  = ifelse((status == 1) & surv_mm<= 120.5, 1, 0), # Redefine status
surv_mm = ifelse(surv_mm<= 120.5, surv_mm, 120.5),     # censored everyone after 120 months
t = surv_mm/12,                                     # surv_mm in years
agegrp1 = (agegrp== 1)+0, # used by time-dependent effect
agegrp2 = (agegrp== 2)+0, # used by time-dependent effect
agegrp3 = (agegrp== 3)+0, # used by time-dependent effect
agegrp4 = (agegrp== 4)+0) # used by time-dependent effect
#' status is coded as follows
#' 1 [Dead: cancer]
#' 2 [Dead: other]
#' 0 [Alive]
#' 4 [Lost to follow-up]
#' agegrp is coded as follows
#' 1 [0-44]
#' 2 [45-59]
#' 3 [60-74]
#' 4 [75+]
#' sex is coded as follows
#' 1 [Male]
#' 2 [Female]
##(a) Kaplan-Meier curve
km <- survfit(Surv(t, event == 1) ~ 1, data = melanoma) # make Kaplan-Meier estimates
summary(km)
# Plot Kaplan-Meier curve
plot(km,
ylab="S(t)",
xlab="analysis time",
main = "Kaplan−Meier survival estimate")
##(b) Weibull model (using stpm2)
fpm_b <- stpm2(Surv(t, event) ~ 1, data = melanoma, df=1)
summary(fpm_b)
eform(fpm_b)
s <- predict(fpm_b, grid=FALSE, full=TRUE, se.fit=FALSE, type="surv")
ggplot(s, aes(x=t,y=Estimate, ymin=0.6, ymax=1)) +
xlab("analysis time") +
ylab("Survival") +
geom_line()
## Overlay KM curve with stpm2-Weibull
plot(km,
ylab="S(t)",
xlab="analysis time",
main = "Kaplan−Meier survival estimate")
lines(s$t, s$Estimate, lwd = 1)
##(c) Plot hazard function
h <- plot(fpm_b, newdata = melanoma, type="haz")
time <- levels(melanoma$t)
s <- predict(fpm_b, newdata = data.frame(t = time ),
grid=FALSE, full=TRUE, se.fit=FALSE, type="surv")
s <- predict(fpm_b, newdata = data.frame(t = tim),
type="surv")
s <- predict(fpm_b, newdata = data.frame(t = time),
type="surv")
h <- plot(fpm_b, newdata = data.frame(t = time), type="haz")
s <- predict(fpm_b, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="surv")
time <- levels(melanoma$t)
View(melanoma)
elanoma$t
melanoma$t
library(dplyr)   # manipulate data
time <- levels(melanoma$t)
levels(melanoma$t)
help levels()
?levels
levels(as.factor(melanoma$t))
time <- levels(as.factor(melanoma$t))
s <- predict(fpm_b, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="surv")
ggplot(s, aes(x=t,y=Estimate, ymin=0.6, ymax=1)) +
xlab("analysis time") +
ylab("Survival") +
geom_line()
plot(km,
ylab="S(t)",
xlab="analysis time",
main = "Kaplan−Meier survival estimate")
lines(s$t, s$Estimate, lwd = 1)
h <- predict(fpm_b, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="haz")
View(h)
ggplot(h, aes(x=t,y=Estimate, ymin=0.6, ymax=1)) +
xlab("analysis time") +
ylab("Hazard") +
geom_line()
ggplot(h, aes(x=t,y=Estimate)) +
xlab("analysis time") +
ylab("Hazard") +
geom_line()
?predict
h <- predict(fpm_b,
newdata = data.frame(t = time),
type="haz")
View(h)
View(h)
hazard_c <- muhaz2(Surv(t, event) ~ 1, data = melanoma)
View(melanoma)
plot(muhaz2(Surv(t, event) ~ 1, data = melanoma))
plot(muhaz2(stpm2(Surv(t, event) ~ 1, data = melanoma, df=1)))
h <- predict(fpm_b, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="haz")
lines(h$t, h$Estimate, lwd = 1)
lines(h$t, h$Estimate, lwd = 1, col(red))
?st-?lines
?lines
lines(h$t, h$Estimate, lwd = 1, col("red"))
lines(h$t, h$Estimate, lwd = 1, col = "red")
legend()
legend("bottomright")
plot(muhaz2(Surv(t, event) ~ 1, data = melanoma))
legend("bottomright")
lines(h$t, h$Estimate, lwd = 1, col = "red")
legend("bottomright", legend = c("Smoothed hazard function", "stpm2"))
legend("bottomright", legend = c("Smoothed hazard function", "stpm2"), col = c("black", "red"))
legend("bottomright", legend = c("Smoothed hazard function", "stpm2"), col = c("black", "red"))
legend("bottomright", legend = c("Smoothed hazard function", "stpm2"), col = c("black", "red"), lty=c("solid", "solid"))
##(c) Plot hazard function
h <- predict(fpm_b, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="haz")
# To plot smoothed hazards, we use the muhaz package
plot(muhaz2(Surv(t, event) ~ 1, data = melanoma))
# Add stpm2-fitted hazard
lines(h$t, h$Estimate, lwd = 1, col = "red")
legend("bottomright", legend = c("Smoothed hazard function", "stpm2"), col = c("black", "red"), lty=c("solid", "solid"))
plot(muhaz2(Surv(t, event) ~ 1, data = melanoma), , ymin=0, ymax=0.05)
plot(muhaz2(Surv(t, event) ~ 1, data = melanoma),  ymin=0, ymax=0.05)
plot(muhaz2(Surv(t, event) ~ 1, data = melanoma))
# Add stpm2-fitted hazard
lines(h$t, h$Estimate, lwd = 1, col = "red")
legend("bottomright", legend = c("Smoothed hazard function", "stpm2"), col = c("black", "red"), lty=c("solid", "solid"))
s <- predict(fpm_d, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="surv")
ggplot(s, aes(x=t,y=Estimate, ymin=0.6, ymax=1)) +
xlab("analysis time") +
ylab("Survival") +
geom_line()
plot(km,
ylab="S(t)",
xlab="analysis time",
main = "Kaplan−Meier survival estimate")
lines(s$t, s$Estimate, lwd = 1)
fpm_d <- stpm2(Surv(t, event) ~ 1, data = melanoma, df=4)
summary(fpm_d)
eform(fpm_d)
s <- predict(fpm_d, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="surv")
ggplot(s, aes(x=t,y=Estimate, ymin=0.6, ymax=1)) +
xlab("analysis time") +
ylab("Survival") +
geom_line()
## Overlay KM curve with stpm2-Weibull
plot(km,
ylab="S(t)",
xlab="analysis time",
main = "Kaplan−Meier survival estimate")
lines(s$t, s$Estimate, lwd = 1)
lines(s$t, s$Estimate, lwd = 1,  col = "red")
legend("bottomright", legend = c("Survival function", "stpm2"), col = c("black", "red"), lty=c("solid", "solid"))
## Hazard function
h <- predict(fpm_d, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="haz")
# To plot smoothed hazards, we use the muhaz package
plot(muhaz2(Surv(t, event) ~ 1, data = melanoma))
# Add stpm2-fitted hazard
lines(h$t, h$Estimate, lwd = 1, col = "red")
legend("bottomright", legend = c("Smoothed hazard function", "stpm2"), col = c("black", "red"), lty=c("solid", "solid"))
##(c) Plot hazard function
h <- predict(fpm_b, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="haz")
# To plot smoothed hazards, we use the muhaz package
plot(muhaz2(Surv(t, event) ~ 1, data = melanoma),
xlim = c(0,10),
ylim = c(0,0.05))
##(d)  try stpm2 with 4 df
fpm_d <- stpm2(Surv(t, event) ~ 1, data = melanoma, df=4)
summary(fpm_d)
eform(fpm_d)
s <- predict(fpm_d, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="surv")
ggplot(s, aes(x=t,y=Estimate, ymin=0.6, ymax=1)) +
xlab("analysis time") +
ylab("Survival") +
geom_line()
## Survival function
plot(km,
ylab="S(t)",
xlab="analysis time",
main = "Kaplan−Meier survival estimate")
lines(s$t, s$Estimate, lwd = 1,  col = "red")
legend("bottomright", legend = c("Survival function", "stpm2"), col = c("black", "red"), lty=c("solid", "solid"))
## Hazard function
h <- predict(fpm_d, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="haz")
# To plot smoothed hazards, we use the muhaz package
plot(muhaz2(Surv(t, event) ~ 1, data = melanoma),
xlim = c(0,10),
ylim = c(0,0.05))
# Add stpm2-fitted hazard
lines(h$t, h$Estimate, lwd = 1, col = "red")
legend("bottomright", legend = c("Smoothed hazard function", "stpm2"), col = c("black", "red"), lty=c("solid", "solid"))
cox_e <- coxph(Surv(t, event) ~ 1, data = melanoma)
summary(cox_e)
eform(cox_e)
summary(cox_e)
cox_e <- coxph(Surv(t, event) ~ year8594, data = melanoma)
summary(cox_e)
fpm_f <- stpm2(Surv(t, event) ~ year8594, data = melanoma, df=4)
summary(fpm_f)
eform(fpm_f)
years <- levels(melanoma$year8594)
years <- levels(melanoma$year8594)
s <- predict(fpm_f,newdata=data.frame(year8594=years),
grid=TRUE,full=TRUE,se.fit=TRUE,
type="surv")
ggplot(s, aes(x=time,y=Estimate,fill=year8594,ymin=lower,ymax=upper)) +
xlab("Time since diagnosis (years)") +
ylab("Survival") +
geom_ribbon(alpha=0.6) +
geom_line()
levels(melanoma$year8594)
years <- levels(as.facotr(melanoma$year8594))
years <- levels(as.factor(melanoma$year8594))
s <- predict(fpm_f,newdata=data.frame(year8594=years),
grid=TRUE,full=TRUE,se.fit=TRUE,
type="surv")
ggplot(s, aes(x=time,y=Estimate,fill=year8594,ymin=lower,ymax=upper)) +
xlab("Time since diagnosis (years)") +
ylab("Survival") +
geom_ribbon(alpha=0.6) +
geom_line()
ggplot(s, aes(x=time,y=Estimate, fill=year8594, ymin=lower, ymax=upper)) +
xlab("Time since diagnosis (years)") +
ylab("Survival") +
geom_ribbon(alpha=0.6) +
geom_line()
View(s)
ggplot(s, aes(x=time,y=Estimate, fill = as.factor(year8594), ymin=lower, ymax=upper)) +
xlab("Time since diagnosis (years)") +
ylab("Survival") +
geom_ribbon(alpha=0.6) +
geom_line()
ggplot(s, aes(x=time,y=Estimate, fill = as.factor(melanoma$year8594), ymin=lower, ymax=upper)) +
xlab("Time since diagnosis (years)") +
ylab("Survival") +
geom_ribbon(alpha=0.6) +
geom_line()
rlang::last_error()
head(s)
ggplot(s, aes(x=time, y=Estimate, fill = year8594, ymin=lower, ymax=upper)) +
xlab("Time since diagnosis (years)") +
ylab("Survival") +
geom_line()
## Read data
melanoma <- read_dta("melanoma.dta")%>%
filter(stage == 1) %>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
female = ifelse(sex == 2, 1, 0), # Create a female variable
event  = ifelse((status == 1) & surv_mm<= 120.5, 1, 0), # Redefine status
surv_mm = ifelse(surv_mm<= 120.5, surv_mm, 120.5),     # censored everyone after 120 months
t = surv_mm/12,                                     # surv_mm in years
agegrp1 = (agegrp== 1)+0, # used by time-dependent effect
agegrp2 = (agegrp== 2)+0, # used by time-dependent effect
agegrp3 = (agegrp== 3)+0, # used by time-dependent effect
agegrp4 = (agegrp== 4)+0) # used by time-dependent effect
library(ggplot2) # ggplot
ggplot2::ggplot(s, aes(x=time, y=Estimate, fill = year8594, ymin=lower, ymax=upper)) +
xlab("Time since diagnosis (years)") +
ylab("Survival") +
geom_line()
ggplot(s, aes(x=time, y=Estimate, fill = year8594, ymin=lower, ymax=upper)) +
xlab("Time since diagnosis (years)") +
ylab("Survival") +
geom_line()
years <- levels(as.factor(melanoma$year8594))
s <- predict(fpm_f,newdata=data.frame(year8594=years),
grid=TRUE,full=TRUE,se.fit=TRUE,
type="surv")
View(s)
ggplot(s, aes(x=t, y=Estimate, fill = year8594, ymin=lower, ymax=upper)) +
xlab("Time since diagnosis (years)") +
ylab("Survival") +
geom_line()
ggplot(s, aes(x=t, y=Estimate, fill = year8594, ymin=lower, ymax=upper)) +
xlab("Time since diagnosis (years)") +
ylab("Survival") +
geom_ribbon(alpha=0.6) +
geom_line()
plot(fpm_f,newdata=data.frame(year8594=years[1]), type="haz",
xlab="Time since diagnosis (years)", ylab="Hazard")
lines(fpma,newdata=data.frame(year8594=years[2]), type="haz", col=2)
legend("topright", legend=years, col=1:2, lty=1, bty="n")
plot(fpm_f,newdata=data.frame(year8594=years[1]), type="haz",
xlab="Time since diagnosis (years)", ylab="Hazard")
lines(fpm_f,newdata=data.frame(year8594=years[2]), type="haz", col=2)
legend("topright", legend=years, col=1:2, lty=1, bty="n")
lines(fpm_f,newdata=data.frame(year8594=years[1]), type="haz",
xlab="Time since diagnosis (years)", ylab="Hazard")
lines(fpm_f,newdata=data.frame(year8594=years[2]), type="haz", col=2)
legend("topright", legend=years, col=1:2, lty=1, bty="n")
lines(fpm_f,newdata=data.frame(year8594=years[1]), type="haz",
xlab="Time since diagnosis (years)", ylab="Hazard")
plot(fpm_f,newdata=data.frame(year8594=years[1]), type="haz",
xlab="Time since diagnosis (years)", ylab="Hazard")
lines(fpm_f,newdata=data.frame(year8594=years[2]), type="haz", col=2)
legend("topright", legend=years, col=1:2, lty=1, bty="n")
plot(fpm_f,newdata=data.frame(year8594=years[1]), type="haz",
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
lines(fpm_f,newdata=data.frame(year8594=years[2]), type="haz", col=2)
legend("topright", legend=years, col=1:2, lty=1, bty="n")
plot(fpm_f,newdata=data.frame(year8594=years[1]), type="haz",
ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
lines(fpm_f,newdata=data.frame(year8594=years[2]), type="haz", col=2)
legend
plot(fpm_f,newdata=data.frame(year8594=years[1]), type="haz",
ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
lines(fpm_f,newdata=data.frame(year8594=years[2]), type="haz", col=2)
legend
## Hazard function
plot(fpm_f,newdata=data.frame(year8594=years[1]), type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
lines(fpm_f,newdata=data.frame(year8594=years[2]), type="haz", col=2)
legend("topright", legend=years, col=1:2, lty=1, bty="n")
plot(fpm_f,newdata=data.frame(year8594=years[1]), type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Log scale of cause-specific mortality rate (per 1000 pys)", log="y")
lines(fpm_f,newdata=data.frame(year8594=years[2]), type="haz", col=2)
legend("topright", legend=years, col=1:2, lty=1, bty="n")
##(i) sensitivity to knots
Rbind <- function(object) do.call(rbind,object)
out <- lapply(1:6, function(i) {
fitaic <- stpm2(Surv(time, event) ~ year8594, data=melanoma, df=i)
data.frame(
i,
AIC=AIC(fitaic),
BIC=BIC(fitaic),
beta=as.numeric(coef(fitaic)[2]),
se=coef(summary(fitaic))[2,2])
})
out %>% Rbind
Rbind <- function(object) do.call(rbind, object)
out <- lapply(1:6, function(i) {
fitaic <- stpm2(Surv(t, event) ~ year8594, data=melanoma, df=i)
data.frame(
i,
AIC=AIC(fitaic),
BIC=BIC(fitaic),
beta=as.numeric(coef(fitaic)[2]),
se=coef(summary(fitaic))[2,2])
})
out %>% Rbind
fitaic0 <- stpm2(Surv(time, event) ~ year8594, data=melanoma0, df=6)
plot(fitaic0,newdata=data.frame(year8594=years[1]), lty=6, ci=FALSE,
xlab="Time since diagnosis (years)")
for (i in 1:5 ) {
fitaic <- stpm2(Surv(time, event) ~ year8594, data=melanoma0, df=i)
lines(fitaic,newdata=data.frame(year8594=years[1]), lty=i)
}
legend("topright", legend=paste0("df=",1:6), lty=1:6)
fitaic0 <- stpm2(Surv(t, event) ~ year8594, data=melanoma, df=6)
plot(fitaic0,newdata=data.frame(year8594=years[1]), lty=6, ci=FALSE,
xlab="Time since diagnosis (years)")
for (i in 1:5 ) {
fitaic <- stpm2(Surv(t, event) ~ year8594, data=melanoma, df=i)
lines(fitaic,newdata=data.frame(year8594=years[1]), lty=i)
}
legend("topright", legend=paste0("df=",1:6), lty=1:6)
## Baseline hazard
fitaic1 <- stpm2(Surv(t, event) ~ year8594, data=melanoma, df=6)
plot(fitaic1,newdata=data.frame(year8594=years[1]), lty=6, type="haz",
ci=FALSE, xlab="Time since diagnosis (years)", ylab="Hazard")
for (i in 1:5 ) {
fitaic <- stpm2(Surv(t, event) ~ year8594, data=melanoma, df=i)
lines(fitaic,type="haz",newdata=data.frame(year8594=years[1]), lty=i)
}
legend("topright", legend=paste0("df=",1:6), lty=1:6)
source('~/cansurv_r/solutions/q131.R', echo=TRUE)
melanoma$t2 <- melanoma$t + rnorm(nrow(melanoma), mean = 0, sd = 0.001)
View(melanoma)
?stpm2
for (i in runif(4, min = 0, max = 100))
{
print(i)
}
for (i in runif(4, min = 0, max = 100))
{
print(i)
}
for (i in runif(4, min = 0, max = 100))
{
print(i)
}
for (i in runif(4, min = 0, max = 100))
{
print(i)
}
fpm_k <- stpm2(Surv(t2, event) ~ year8594, data=melanoma, df=c(22, 33))
summary(fpm_k)
kk<- list(for (i in runif(4, min = 0, max = 100))
{
print(i)
})
View(kk)
nsx(kk)
nsx(melanoma$t2 , knots = kk)
?nsx
??nsx
fpm_k <- stpm2(Surv(t2, event) ~ nsx(year8594, knots = c(22,33)), data=melanoma)
## Load the packages
library(biostat3)
library(haven)
library(dplyr)   # manipulate data
library(rstpm2)  # nsx
library(ggplot2) # ggplot
## Read data
melanoma <- read_dta("melanoma.dta")%>%
filter(stage == 1) %>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
female = ifelse(sex == 2, 1, 0), # Create a female variable
event  = ifelse((status == 1) & surv_mm<= 120.5, 1, 0), # Redefine status
surv_mm = ifelse(surv_mm<= 120.5, surv_mm, 120.5),     # censored everyone after 120 months
t = surv_mm/12,                                     # surv_mm in years
agegrp1 = (agegrp== 1)+0, # used by time-dependent effect
agegrp2 = (agegrp== 2)+0, # used by time-dependent effect
agegrp3 = (agegrp== 3)+0, # used by time-dependent effect
agegrp4 = (agegrp== 4)+0) # used by time-dependent effect
fpm_k <- stpm2(Surv(t2, event) ~ nsx(year8594, knots = c(22,33)), data=melanoma)
fpm_k <- stpm2(Surv(t, event) ~ nsx(year8594, knots = c(22,33)), data=melanoma)
?ns
fpm_k <- stpm2(Surv(t, event) ~ nsx(year8594, knots = c(5, 8, 9)), data=melanoma)
fpm_k <- stpm2(Surv(t, event) ~ nsx(year8594, knots = c(5, 8, 9)), data=melanoma)
fpm_k <- stpm2(Surv(t, event) ~ nsx(year8594, knots = c(5, 8, 9)), data=melanoma, df =5 )
fpm_k <- stpm2(Surv(t, event) ~ (year8594, knots = c(5, 8, 9)), data=melanoma, df =5 )
fpm_k <- stpm2(Surv(t, event) ~ year8594, data=melanoma, df =5 )
summary(fpm_k)
fpm_k <- stpm2(Surv(t, event) ~ year8594 + nsx(log(t), knots = c(5, 8, 9)), data=melanoma, df =5 )
fpm_k <- stpm2(Surv(t, event) ~ year8594 + nsx(log(t), knots = c(5, 8, 9)), data=melanoma )
fpm_k <- stpm2(Surv(t, event) ~ year8594 + nsx(log(t), knots = c(5, 8, 9)), data=melanoma )
fpm_k <- stpm2(Surv(t, event) ~ year8594 + nsx(t, knots = c(5, 8, 9)), data=melanoma )
summary(fpm_k)
fpm_k <- stpm2(Surv(t, event) ~ year8594 + nsx(log(t), df=5), data=melanoma )
fpm_k <- stpm2(Surv(t, event) ~ year8594 + nsx(t, knots = c(5, 8, 9)), data=melanoma, df =5 )
fpm_k <- stpm2(Surv(log(t), event) ~ year8594 , data=melanoma, df =5 )
fpm_k <- stpm2(Surv(nsx(log(t), knots = c(3, 5, 9), event)) ~ year8594 , data=melanoma)
spline <- nsx(melanoma$t, knots = c(3, 5, 7), log=TRUE)
spline <- nsx(melanoma$t, knots = c(1), log=TRUE)
spline
spline <- nsx(melanoma$t, knots = c(3, 5, 7), log=TRUE)
spline
fpm_k <- stpm2(Surv(t, event) ~ year8594 + spline, data=melanoma)
melanoma$spline <- nsx(melanoma$t, knots = c(3, 5, 7), log=TRUE)
fpm_k <- stpm2(Surv(t, event) ~ year8594 + spline, data=melanoma)
summary(fpm_k)
melanoma$spline <- nsx(melanoma$t, knots = c(3, 5, 7))
fpm_k <- stpm2(Surv(t, event) ~ year8594 + spline, data=melanoma)
fpm_k <- stpm2(Surv(t, event) ~ spline, data=melanoma)
knots <- quantile((melanoma$t, probs=c(.2, .35, .5))
knots <- quantile(melanoma$t, probs=c(.2, .35, .5))
knots
melanoma$spline <- nsx(melanoma$t, knots = knots)
melanoma$spline
fpm_k <- stpm2(Surv(t, event) ~ year8594 + spline, data=melanoma)
View(melanoma)
fpm_k <- stpm2(Surv(t, event) ~ year8594 , data=melanoma, df =5 )
summary(fpm_k)
knots <- quantile(melanoma$t, probs=c(0, .2, .4, .6, .8, 1))
knots
knots <- quantile(melanoma$t, probs=c(0, .2, .4, .6, .8, 1))
melanoma$spline <- nsx(melanoma$t, knots = knots)
knots <- quantile(melanoma$t, probs=c(0, .2, .4, .6, .8))
melanoma$spline <- nsx(melanoma$t, knots = knots)
knots <- quantile(melanoma$t, probs=c(0, .2, .4, .6, .8))
class(knots)
knots <- lists(quantile(melanoma$t, probs=c(0, .2, .4, .6, .8)))
knots <- list(quantile(melanoma$t, probs=c(0, .2, .4, .6, .8)))
melanoma$spline <- nsx(melanoma$t, knots = knots)
