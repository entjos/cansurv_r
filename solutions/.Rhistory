library(biostat3)
library(haven)
library(dplyr)   # manipulate data
## Read data
## subset of stage 1
melanoma <- read_dta("melanoma.dta")%>%
filter(stage == 1)%>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
agegrp = as.factor(agegrp),
sex = as.factor(sex))
#' status is coded as follows
#' 1 [Dead: cancer]
#' 2 [Dead: other]
#' 0 [Alive]
#' 4 [Lost to follow-up]
#' agegrp is coded as follows
#' 1 [0-44]
#' 2 [45-59]
#' 3 [60-74]
#' 4 [75+]
#' sex is coded as follows
#' 1 [Male]
#' 2 [Female]
# Restrict follow-up to 10 years and create new variable for all-cause death
melanoma_10y <- mutate(melanoma,
status_all= ifelse(surv_mm <= 120 & status == 1 | 2, 1, 0),
surv_mm = ifelse(surv_mm<=120, surv_mm, 120), # censored everyone after 120 months
)
head(melanoma_10y)
head(melanoma_10y$, status, status_all)
head(melanoma_10y$status, melanoma_10y$status_all)
View(melanoma_10y)
melanoma_10y <- mutate(melanoma,
status_all= ifelse(surv_mm <= 120 & status == 1 | status == 2, 1, 0),
surv_mm = ifelse(surv_mm<=120, surv_mm, 120), # censored everyone after 120 months
)
View(melanoma_10y)
melanoma_10y <- mutate(melanoma,
status_all= ifelse(surv_mm <= 120 & (status == 1 | status == 2), 1, 0),
surv_mm = ifelse(surv_mm<=120, surv_mm, 120), # censored everyone after 120 months
)
View(melanoma_10y)
# Restrict follow-up to 10 years and create new variable for all-cause death
melanoma_10y <- mutate(melanoma,
status_all= ifelse(surv_mm <= 120 & (status == 1 | status == 2), 1, 0),
surv_mm = ifelse(surv_mm<=120, surv_mm, 120), # censored everyone after 120 months
)
cox_a <- coxph(Surv(surv_mm, status_all) ~ sex + year8594 + agegrp,
data = melanoma_10y)
summary(cox_a)
##(b) Cox regression with cause-specific death (cancer)
cox_b <- coxph(Surv(surv_mm, status_cancer) ~ sex + year8594 + agegrp,
data = melanoma_10y)
summary(cox_b)
melanoma_10y <- mutate(melanoma,
status_all= ifelse(surv_mm <= 120 & (status == 1 | status == 2), 1, 0),
status_cancer = ifelse(surv_mm <= 120 & status == 1 , 1, 0),
surv_mm = ifelse(surv_mm<=120, surv_mm, 120), # censored everyone after 120 months
)
cox_b <- coxph(Surv(surv_mm, status_cancer) ~ sex + year8594 + agegrp,
data = melanoma_10y)
summary(cox_b)
source('~/cansurv_r/solutions/q122.R', echo=TRUE)
cox_a <- coxph(Surv(surv_mm, death_cancer) ~ sex, data=melanoma)
summary(cox_a)
melanoma <- mutate(melanoma,
status_cancer = ifelse(surv_mm <= 120 & status == 1 , 1, 0),
)
##(a) Cox regression
cox_a <- coxph(Surv(surv_mm, death_cancer) ~ sex, data=melanoma)
summary(cox_a)
cox_a <- coxph(Surv(surv_mm, status_cancer) ~ sex, data=melanoma)
summary(cox_a)
library(biostat3)
library(haven)
library(dplyr)   # manipulate data
## Read data
## All stages
melanoma <- read_dta("melanoma.dta")%>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
agegrp = as.factor(agegrp),
sex = as.factor(sex))
#' status is coded as follows
#' 1 [Dead: cancer]
#' 2 [Dead: other]
#' 0 [Alive]
#' 4 [Lost to follow-up]
#' agegrp is coded as follows
#' 1 [0-44]
#' 2 [45-59]
#' 3 [60-74]
#' 4 [75+]
#' sex is coded as follows
#' 1 [Male]
#' 2 [Female]
# Create new variable for cause-specific death
melanoma <- mutate(melanoma,
status_cancer = ifelse(surv_mm <= 120 & status == 1 , 1, 0),
)
cox_a <- coxph(Surv(surv_mm, status_cancer) ~ sex, data=melanoma)
summary(cox_a)
melanoma <- read_dta("melanoma.dta")%>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
agegrp = as.factor(agegrp),
sex = as.factor(sex))
View(melanoma)
# Create new variable for cause-specific death
melanoma <- mutate(melanoma,
status_cancer = ifelse(status == 1 , 1, 0),
)
##(a) Cox regression
cox_a <- coxph(Surv(surv_mm, status_cancer) ~ sex, data=melanoma)
summary(cox_a)
cox_b <- coxph(Surv(surv_mm, status_cancer) ~ sex + agegrp + stage + subsite + year8594, data=melanoma.l)
summary(cox_b)
cox_b <- coxph(Surv(surv_mm, status_cancer) ~ sex + agegrp + stage + subsite + year8594, data=melanoma)
summary(cox_b)
##(b) Cox regression controlling for possible confounders
cox_b <- coxph(Surv(surv_mm, status_cancer) ~ sex + agegrp + stage + subsite + year8594, data=melanoma)
summary(cox_b)
melanoma <- read_dta("melanoma.dta")%>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
agegrp = as.factor(agegrp),
sex = as.factor(sex),
subsite = as.factor(subsite))
melanoma <- mutate(melanoma,
status_cancer = ifelse(status == 1 , 1, 0),
)
##(a) Cox regression
# Note:  R uses the Efron method for approximating the likelihood in the presence of ties.
# Stata uses the Breslow method.
cox_a <- coxph(Surv(surv_mm, status_cancer) ~ sex, data=melanoma)
summary(cox_a)
##(b) Cox regression controlling for possible confounders
cox_b <- coxph(Surv(surv_mm, status_cancer) ~ sex + agegrp + stage + subsite + year8594, data=melanoma)
summary(cox_b)
melanoma <- read_dta("melanoma.dta")%>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
agegrp = as.factor(agegrp),
sex = as.factor(sex),
stage = as.factor(stage),
subsite = as.factor(subsite))
#' status is coded as follows
#' 1 [Dead: cancer]
#' 2 [Dead: other]
#' 0 [Alive]
#' 4 [Lost to follow-up]
#' agegrp is coded as follows
#' 1 [0-44]
#' 2 [45-59]
#' 3 [60-74]
#' 4 [75+]
#' sex is coded as follows
#' 1 [Male]
#' 2 [Female]
#'
#' subsite is coded as follows
#' 1  [Head and Neck]
#' 2  [Trunk]
#' 3  [Limbs]
#' 4  [Multiple and NOS]
#'
#' stage is coded as follows
#' 0  [Unknown]
#' 1  [Localised]
#' 2  [Regional]
#' 3  [Distant]
# Create new variable for cause-specific death
melanoma <- mutate(melanoma,
status_cancer = ifelse(status == 1 , 1, 0),
)
##(a) Cox regression
# Note:  R uses the Efron method for approximating the likelihood in the presence of ties.
# Stata uses the Breslow method.
cox_a <- coxph(Surv(surv_mm, status_cancer) ~ sex, data=melanoma)
summary(cox_a)
##(b) Cox regression controlling for possible confounders
cox_b <- coxph(Surv(surv_mm, status_cancer) ~ sex + agegrp + stage + subsite + year8594, data=melanoma)
summary(cox_b)
cox_c <- coxph(Surv(surv_mm, status_cancer) ~ agegrp + agegrp * sex, data=melanoma.l)
summary(cox_c)
##(c) Cox regression with interactions
cox_c <- coxph(Surv(surv_mm, status_cancer) ~ agegrp + agegrp * sex, data=melanoma)
summary(cox_c)
cox_c <- coxph(Surv(surv_mm, status_cancer) ~ agegrp + sex * agegrp, data=melanoma)
summary(cox_c)
cox_c <- coxph(Surv(surv_mm, status_cancer) ~ agegrp + sex * agegrp, data=melanoma)
summary(cox_c)
##(c) Cox regression with interactions
cox_c <- coxph(Surv(surv_mm, status_cancer) ~ sex * agegrp, data=melanoma)
summary(cox_c)
cox_d <- coxph(Surv(surv_mm, status_cancer) ~ sex * agegrp, data=melanoma)
summary(cox_d)
cox_c <- coxph(Surv(surv_mm, status_cancer) ~ sex * agegrp, data=melanoma)
summary(cox_c)
##(c) Cox regression with interactions
cox_c <- coxph(Surv(surv_mm, status_cancer) ~ sex * agegrp, data=melanoma)
summary(cox_c)
cox.zph(cox_c, transform="log")
cox.zph(cox_c, transform="identity")
cox.zph(cox_c)
cox.zph(cox_c, transform="log")
anova(cox_c)
cox_d <- coxph(Surv(surv_mm, status_cancer) ~ sex + year8594 + agegrp + subsite + stage, data=melanoma)
summary(cox_d)
cox.zph(cox_d, transform="identity") # Stata default
cox_c2 <- coxph(Surv(surv_mm, status_cancer) ~ year8594 + subsite + stage + sex * agegrp, data=melanoma)
summary(cox_c2)
cox.zph(cox_c2, transform="identity") # Stata default
cox.zph(cox_c2, transform="log") # Stata default
anova(cox_c2)
cox.zph(cox_c, transform="identity") # Stata default
cox.zph(cox_c2, transform="identity") # Stata default
cox_strat <- coxph(Surv(surv_mm, status_cancer) ~ sex + year8594 + agegrp + subsite + strata(stage), data=melanoma)
summary(cox_strat)
cox.zph(cox_strat, transform="identity") # Stata default
cox_strat2 <- coxph(Surv(surv_mm, status_cancer) ~ sex + year8594 + agegrp  + strata(stage), data=melanoma)
summary(cox_strat2)
cox.zph(cox_strat2, transform="identity")
cox_strat3 <- coxph(Surv(surv_mm, status_cancer) ~ sex * agegrp + year8594 + agegrp + subsite + strata(stage), data=melanoma)
summary(cox_strat3)
anova(cox_strat3)
source('~/cansurv_r/solutions/q123.R', echo=TRUE)
getwd()
## Exercise 124
## Created: 2021-04-07 Enoch Chen
## Edited:  2021-04-07 Enoch Chen
## Reference: Biostatistics III in R. https://biostat3.net/download/R/solutions/q13.html
###############################################################################
## Load the packages
library(biostat3)
library(haven)
## Read data
diet <- read_dta("diet.dta")
## Check the loaded data
head(diet)
##(a) Poisson regression
poisson_a <- glm( chd ~ hieng + offset( log( y ) ), family=poisson, data=diet)
summary(poisson_a)
eform(poisson_a)
cox_a <- coxph(Surv(y, chd) ~ hieng, data=diet)
summary(cox_a)
scale <- 365.24
cox_b <- coxph(Surv((doe-dob)/scale, (dox-dob)/scale, chd) ~ hieng, data=diet)
summary(cox_b)
## Exercise 125
## Created: 2021-04-09 Enoch Chen
## Edited:  2021-04-09 Enoch Chen
## Reference: Biostatistics III in R. https://biostat3.net/download/R/solutions/q22.html
###############################################################################
## Load the packages
library(biostat3)
library(haven)
library(dplyr)
## Read data
brv <- read_dta("brv.dta")
## Check the loaded data
head(brv)
brv %>% select(id, sex, doe, dosp, dox, fail, couple) %>% filter(couple=3|4|19|7) %>% arrange(couple, id)
brv %>% select(id, sex, doe, dosp, dox, fail, couple) %>% filter(couple== 3| 4| 19| 7) %>% arrange(couple, id)
brv %>% select(id, sex, doe, dosp, dox, fail, couple) %>%
filter(couple== 3 | couple== 4 | couple== 19 | couple == 7)  %>%
arrange(couple, id)
scale <- 365.24
brv <- mutate(brv, age_entry = as.numeric(doe - dob) / scale, # Calc age at entry
att_age = as.numeric(dox - dob) / scale,   # Calc attained age
t_at_risk = att_age - age_entry)
survRate(Surv(age_entry, att_age, fail) ~ sex, data=brv)
brv <- mutate(brv, age_entry = as.numeric(doe - dob) / scale, # Calc age at entry
att_age = as.numeric(dox - dob) / scale,   # Calc attained age
t_at_risk = (att_age - age_entry)/1000)
survRate(Surv(age_entry, att_age, fail) ~ sex, data=brv)
survRate(Surv(age_entry/1000, att_age, fail) ~ sex, data=brv)
survRate(Surv(age_entry/1000, att_age/1000, fail) ~ sex, data=brv)
poisson_b <- glm( fail ~ sex + offset( log( t_at_risk) ), family=poisson, data=brv)
summary(poisson_b)
eform(poisson_b)
select(brv, sex, age_entry) %>%
group_by(sex) %>%
summarise(mean_age_entry = mean(age_entry))
brv2 <- mutate(brv,
id=NULL,
y_before_sp_dth =  as.numeric(doe -dosp) / scale,
y_after_sp_dth = as.numeric(dox - dosp) / scale)
brv <- mutate(brv,
id=NULL,
y_before_sp_dth =  as.numeric(doe -dosp) / scale,
y_after_sp_dth = as.numeric(dox - dosp) / scale)
brv_split <- survSplit(brv, cut = 0, end="y_after_sp_dth", start="y_before_sp_dth", id="id",event="fail")
brv_split <- mutate(brv_split,
t_sp_at_risk =   y_after_sp_dth - y_before_sp_dth,
brv = ifelse(y_after_sp_dth > 0, 1, 0))
## Look at the five first couples
brvSplit %>% select(couple, id, sex, doe, dosp, dox, fail, y_before_sp_dth, y_after_sp_dth, t_sp_at_risk)  %>%
filter(couple<=5) %>% arrange(couple, id)
brv_split %>% select(couple, id, sex, doe, dosp, dox, fail, y_before_sp_dth, y_after_sp_dth, t_sp_at_risk)  %>%
filter(couple<=5) %>% arrange(couple, id)
## Take a look at the five first couples
brv_split %>% select(couple, id, sex, doe, dosp, dox, fail, y_before_sp_dth, y_after_sp_dth, t_sp_at_risk)  %>%
filter(couple== 3 | couple== 4 | couple== 19 | couple == 7)  %>%
arrange(couple, id)
## (d) Poisson regression
poisson_d <- glm( fail ~ brv + offset( log(t_sp_at_risk) ), family=poisson, data=brv_split)
summary(poisson_d)
eform(poisson_d)
## sex = 1, Male
poisson_e1 <- glm( fail ~ brv + offset( log(t_sp_at_risk) ), family=poisson, data=filter(brv_split, sex==1))
summary(poisson_e1)
eform(poisson_e1)
## sex = 2, Female
poisson_e2 <- glm( fail ~ brv + offset( log(t_sp_at_risk) ), family=poisson, data=filter(brv_split, sex==2))
summary(poisson_e2)
eform(poisson_e2)
brv_split <- mutate(brv_split,
sex = as.factor(sex),
brv = as.factor(brv))
poisson_e3 <- glm( fail ~ sex + brv:sex + offset( log(t_sp_at_risk) ), family=poisson, data=brv_split)
summary(poisson_e3)
eform(poisson_e3)
brv_split <- brv_split %>%
mutate(age_sp_dth =  as.numeric(dosp - dob) / scale, # Age at spouse death
t0 = age_sp_dth + y_before_sp_dth,      # Age at start of timeband
t  = age_sp_dth + y_after_sp_dth)       # Age at end of timeband
mean(t0)
mean(brv_split$t0)
mean(brv_split$t)
summarise(brv_split$t0)
summarise(brv_split$t)
summarise(brv_split, t0)
summarise(brv_split, t)
summarise(brv_split, t0, mean(), min(), max())
summarise(brv_split, mean(t0), min(t0), max(t0))
summarise(brv_split, mean(t), min(t), max(t))
## Split follow up time (=age) to be able to control for age bands in Poisson model
age_cat <- seq(70,100,5)
brv_split <- survSplit(brv_split, cut=age_cat, start="t0", end="t", event="fail", zero = 0)
## Creating age band category
brv_split <- mutate(brv_split,
age = cut(age_end, age_cat))
## Creating age band category
brv_split <- mutate(brv_split,
age = cut(t, age_cat))
## Poisson model controlling for age
survRate(Surv(t_at_risk, fail) ~ age, data=brv_split)
brv_split <- survSplit(brv_split, cut=age_cat, start="t0", end="t", event="fail", zero = 0)
View(brv_split)
brv_split <- brv_split %>%
mutate(age_sp_dth =  as.numeric(dosp - dob) / scale, # Age at spouse death
t0 = age_sp_dth + y_before_sp_dth,      # Age at start of timeband
t  = age_sp_dth + y_after_sp_dth,
t_at_risk = t0 - t )       # Age at end of timeband
summarise(brv_split, mean(t0), min(t0), max(t0))
summarise(brv_split, mean(t), min(t), max(t))
## Split follow up time (=age) to be able to control for age bands in Poisson model
age_cat <- seq(70,100,5)
brv_split <- survSplit(brv_split, cut=age_cat, start="t0", end="t", event="fail", zero = 0)
## Creating age band category
brv_split <- mutate(brv_split,
age = cut(t, age_cat))
## Poisson model controlling for age
survRate(Surv(t_at_risk, fail) ~ age, data=brv_split)
brv_split <- brv_split %>%
mutate(age_sp_dth =  as.numeric(dosp - dob) / scale, # Age at spouse death
t0 = age_sp_dth + y_before_sp_dth,      # Age at start of timeband
t  = age_sp_dth + y_after_sp_dth,       # Age at end of timeband
t_at_risk = t0 - t )
View(brv_split)
brv_split <- brv_split %>%
mutate(age_sp_dth =  as.numeric(dosp - dob) / scale, # Age at spouse death
t0 = age_sp_dth + y_before_sp_dth,      # Age at start of timeband
t  = age_sp_dth + y_after_sp_dth,       # Age at end of timeband
t_at_risk = t - t0 )
summarise(brv_split, mean(t0), min(t0), max(t0))
summarise(brv_split, mean(t), min(t), max(t))
## Split follow up time (=age) to be able to control for age bands in Poisson model
age_cat <- seq(70,100,5)
brv_split <- survSplit(brv_split, cut=age_cat, start="t0", end="t", event="fail", zero = 0)
## Creating age band category
brv_split <- mutate(brv_split,
age = cut(t, age_cat))
## Poisson model controlling for age
survRate(Surv(t_at_risk, fail) ~ age, data=brv_split)
View(brv_split)
## Exercise 125
## Created: 2021-04-09 Enoch Chen
## Edited:  2021-04-09 Enoch Chen
## Reference: Biostatistics III in R. https://biostat3.net/download/R/solutions/q22.html
###############################################################################
## Load the packages
library(biostat3)
library(haven)
library(dplyr)
## Read data
brv <- read_dta("brv.dta")
#' variables are coded as follows
#' couple: id for couple
#' dob: Date of birth
#' doe: Date of entry into study
#' dox: Date of exit from study
#' dosp:  Date of bereavement
#' fail:  0 = alive, 1=died
#' group: 1, 2, 3
#' disab: 0, 1, 2, 3
#' health: Perceived health status: 0, 1, 2
#' sex: 1=M, 2=F
## Check the loaded data
head(brv)
##(a) list selected variables
brv %>% select(id, sex, doe, dosp, dox, fail, couple) %>%
filter(couple== 3 | couple== 4 | couple== 19 | couple == 7)  %>%
arrange(couple, id)
##(b) Crude mortality rate for each sex
scale <- 365.24
brv <- mutate(brv, age_entry = as.numeric(doe - dob) / scale, # Calc age at entry
att_age = as.numeric(dox - dob) / scale,   # Calc attained age
t_at_risk = att_age - age_entry)           # Calc time at risk
## Crude rates per 1000 person-years
survRate(Surv(age_entry/1000, att_age/1000, fail) ~ sex, data=brv)
## Poisson regression
poisson_b <- glm( fail ~ sex + offset( log( t_at_risk) ), family=poisson, data=brv)
summary(poisson_b)
eform(poisson_b)
## Calculate mean entry age by sex
select(brv, sex, age_entry) %>%
group_by(sex) %>%
summarise(mean_age_entry = mean(age_entry))
##(c) Breaking records into pre and post bereavement
## Creating times relative to spouse death (year=0)
brv <- mutate(brv,
id=NULL,
y_before_sp_dth =  as.numeric(doe -dosp) / scale,
y_after_sp_dth = as.numeric(dox - dosp) / scale)
## Splitting at spouse death (year=0)
brv_split <- survSplit(brv, cut = 0, end="y_after_sp_dth", start="y_before_sp_dth", id="id",event="fail")
## Calculating risk times
brv_split <- mutate(brv_split,
t_sp_at_risk =   y_after_sp_dth - y_before_sp_dth,
brv = ifelse(y_after_sp_dth > 0, 1, 0))
## Take a look at the five first couples
brv_split %>% select(couple, id, sex, doe, dosp, dox, fail, y_before_sp_dth, y_after_sp_dth, t_sp_at_risk)  %>%
filter(couple== 3 | couple== 4 | couple== 19 | couple == 7)  %>%
arrange(couple, id)
## (d) Poisson regression
poisson_d <- glm( fail ~ brv + offset( log(t_sp_at_risk) ), family=poisson, data=brv_split)
summary(poisson_d)
eform(poisson_d)
##(e) Poisson regression stratified on sex
## sex = 1, Male
poisson_e1 <- glm( fail ~ brv + offset( log(t_sp_at_risk) ), family=poisson, data=filter(brv_split, sex==1))
summary(poisson_e1)
eform(poisson_e1)
## sex = 2, Female
poisson_e2 <- glm( fail ~ brv + offset( log(t_sp_at_risk) ), family=poisson, data=filter(brv_split, sex==2))
summary(poisson_e2)
eform(poisson_e2)
## Poisson regression with effect of bereavement by sex
brv_split <- mutate(brv_split,
sex = as.factor(sex),
brv = as.factor(brv))
poisson_e3 <- glm( fail ~ sex + brv:sex + offset( log(t_sp_at_risk) ), family=poisson, data=brv_split)
summary(poisson_e3)
eform(poisson_e3)
## (f) Controlling for age.
## Look at mean and lowest/highest value for _t0 and _t
brv_split <- brv_split %>%
mutate(age_sp_dth =  as.numeric(dosp - dob) / scale, # Age at spouse death
t0 = age_sp_dth + y_before_sp_dth,      # Age at start of timeband
t  = age_sp_dth + y_after_sp_dth,       # Age at end of timeband
t_at_risk = t - t0 )
summarise(brv_split, mean(t0), min(t0), max(t0))
summarise(brv_split, mean(t), min(t), max(t))
## Split follow up time (=age) to be able to control for age bands in Poisson model
age_cat <- seq(70,100,5)
brv_split <- survSplit(brv_split, cut=age_cat, start="t0", end="t", event="fail", zero = 0)
## Creating age band category
brv_split <- mutate(brv_split,
age = cut(t, age_cat))
survRate(Surv(t_at_risk, fail) ~ age, data=brv_split)
brv_split <- brv_split %>%
mutate(age_sp_dth =  as.numeric(dosp - dob) / scale, # Age at spouse death
t0 = age_sp_dth + y_before_sp_dth,      # Age at start of timeband
t  = age_sp_dth + y_after_sp_dth)       # Age at end of timeband
summarise(brv_split, mean(t0), min(t0), max(t0))
summarise(brv_split, mean(t), min(t), max(t))
## Split follow up time (=age) to be able to control for age bands in Poisson model
age_cat <- seq(70,100,5)
brv_split <- survSplit(brv_split, cut=age_cat, start="t0", end="t", event="fail", zero = 0)
## Creating age band category
brv_split <- mutate(brv_split,
age = cut(t, age_cat),
t_at_risk = t - t0 )
## Poisson model controlling for age
survRate(Surv(t_at_risk, fail) ~ age, data=brv_split)
source('~/cansurv_r/solutions/q125.R', echo=TRUE)
poisson_f <- glm( fail ~ brv + age + offset( log(t_at_risk) ), family=poisson, data=brv_split)
summary(poisson_f)
eform(poisson_f)
summary(poisson_f2)
eform(poisson_f2)
poisson_f2 <- glm( fail ~ brv +age + sex + offset( log(t_at_risk) ), family=poisson, data=brv_split)
summary(poisson_f2)
eform(poisson_f2)
poisson_g <- glm( fail ~ age + sex + brv:sex + offset( log(t_at_risk) ), family=poisson, data=brv_split)
summary(poisson_g)
summary(poisson_g)
eform(poisson_g)
##(i) Cox regression adjusted for age
summary(coxph(Surv(t0, t, fail) ~ brv,
data = brv_split))
summary(coxph(Surv(t0, t, fail) ~ sex + sex:brv,
data = brv_split))
source('~/cansurv_r/solutions/q125.R', echo=TRUE)
