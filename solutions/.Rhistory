mutate(year8594 = as_factor(year8594),
female = as_factor(female),
agegrp = as_factor(agegrp),
agegrp1 = as_factor(agegrp1),
agegrp2 = as_factor(agegrp2),
agegrp3 = as_factor(agegrp3),
agegrp4 = as_factor(agegrp4))
str(melanoma)
#' status is coded as follows
#' 1 [Dead: cancer]
#' 2 [Dead: other]
#' 0 [Alive]
#' 4 [Lost to follow-up]
#' agegrp is coded as follows
#' 0 [0-44]
#' 1 [45-59]
#' 2 [60-74]
#' 3 [75+]
#' female is coded as follows
#' 0 [Male]
#' 1 [Female]
##(a) fit a Cox model
# Assees the PH assumption for age group
cox_a <- coxph(Surv(t, event) ~ year8594 + female + agegrp, data = melanoma)
summary(cox_a)
cox_a.phtest <- cox.zph(cox_a, transform="identity")
plot(cox_a.phtest[2], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals", ylim=c(-4,4))
View(cox_a.phtest)
plot(cox_a.phtest[1], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals", ylim=c(-4,4))
plot(cox_a.phtest[2], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals", ylim=c(-4,4))
plot(cox_a.phtest[3], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals", ylim=c(-4,4))
plot(cox_a.phtest[4], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals", ylim=c(-4,4))
plot(cox_a.phtest[5], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals", ylim=c(-4,4))
plot(cox_a.phtest[3], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals", ylim=c(-4,4))
plot(cox_a.phtest[3], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals", ylim=c(-4,4))
View(cox_a.phtest)
cox_a.phtest[1,]
cox_a.phtest[2,]
cox_a.phtest[3,]
View(cox_a.phtest)
cox_a.phtest[4,]
cox_a.phtest[1,1]
cox_a.phtest[1,2]
cox_a.phtest[1,7]
View(cox_a.phtest)
unlist(cox_a.phtest)
matrix(unlist(l), nrow=length(l), byrow=TRUE)
print(cox_a.phtest)
cox_a <- coxph(Surv(t, event) ~ year8594 + female + agegrp1 + agegrp2 + agegrp3, data = melanoma)
summary(cox_a)
print(cox_a.phtest)
cox_a.phtest <- cox.zph(cox_a, transform="identity")
print(cox_a.phtest)
cox_a.phtest <- cox.zph(cox_a, transform="log")
print(cox_a.phtest)
anova(cox_a)
cox_a <- coxph(Surv(t, event) ~ year8594 + female + agegrp1 + agegrp2 + agegrp3, data = melanoma)
summary(cox_a)
plot(cox_a.phtest[3], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals", ylim=c(-4,4))
plot(cox_a.phtest[4], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals", ylim=c(-5,5))
plot(cox_a.phtest[2], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals")
plot(cox_a.phtest[3], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals")
plot(cox_a.phtest[3], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals")
print(cox_a.phtest)
summary(cox_a)
cox_a.phtest <- cox.zph(cox_a, transform="identity")
print(cox_a.phtest)
cox_a.phtest <- cox.zph(cox_a, transform="identity")
cox_a <- coxph(Surv(t, event) ~ female + year8594 + agegrp1 + agegrp2 + agegrp3, data = melanoma)
cox_a.phtest <- cox.zph(cox_a, transform="identity")
print(cox_a.phtest)
plot(cox_a.phtest[4], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals")
plot(cox_a.phtest[5], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals")
plot(cox_a.phtest[3], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals")
##(b) fit flexible parametric model
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 + agegrp1 + agegrp2 + agegrp3, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
library(rstpm2)
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 + agegrp1 + agegrp2 + agegrp3, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 + agegrp, data = melanoma, df=4)
eform(fpm_b)
summary(fpm_b)
eform(fpm_b)
##(b) fit flexible parametric model
summary(fpm_b)
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 +  agegrp1 + agegrp2 + agegrp3, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
cox_a <- coxph(Surv(t, event) ~ female + year8594 + agegrp1 + agegrp2 + agegrp3, data = melanoma)
summary(cox_a)
cox_a <- coxph(Surv(t, event) ~ female + year8594 + agegrp2 + agegrp3 + agegrp4, data = melanoma)
summary(cox_a)
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 +  agegrp2 + agegrp3 + agegrp4, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
cox_a.phtest <- cox.zph(cox_a, transform="identity")
print(cox_a.phtest)
plot(cox_a.phtest[3], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals")
plot(cox_a.phtest[4], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals")
plot(cox_a.phtest[5], resid=TRUE, se=TRUE, main="Test of PH assumption: Schoenfeld residuals")
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 +  agegrp2 + agegrp3 + agegrp4, data = melanoma, df=4)
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 +  agegrp, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
agegrps <- levels(melanoma$agegrp)
plot(fpm_b,newdata=data.frame(agegrp=agegrps[1]), type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per py)")
agegrps <- levels(melanoma$agegrp)
plot(fpm_b,newdata=data.frame(agegrp=agegrps[1]), type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
plot(fpm_b,newdata=data.frame(female=0, year8594=0, agegrps[1]), type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
agegrps <- levels(melanoma$agegrp)
agegrps
plot(fpm_b,newdata=data.frame(female=0, year8594=0, agegrps[1]), type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
plot(fpm_b,newdata=data.frame(female=0, year8594=0, agegrp2=0, agegrp3=0, agegrp4=0), type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
newdata1 <- data.frame(female=0, year8594=0, agegrp2=0, agegrp3=0, agegrp4=0)
newdata1 <- data.frame(female=0, year8594=0, agegrp2=0, agegrp3=0, agegrp4=0)
View(melanoma)
View(newdata1)
newdata1 <- data.frame(female=0, year8594=0, agegrp1=1, agegrp2=0, agegrp3=0, agegrp4=0)
plot(fpm_b,newdata=newdata1, type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
females <- levels(melanoma$female)
years <- levels(melanoma$year8594)
newdata1 <- data.frame(female=females[1],year8594=years[1], agegrp1=1, agegrp2=0, agegrp3=0, agegrp4=0)
plot(fpm_b,newdata=newdata1, type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
eform(fpm_b)
females[1]
years[1]
newdata1 <- data.frame(female=females[1],year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0)
plot(fpm_b,newdata=newdata1, type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
h <- predict(fpm_b, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = time),
type="haz")
h <- predict(fpm_b, grid=TRUE,full=TRUE,se.fit=TRUE,
newdata = data.frame(t = t),
type="haz")
h <- predict(fpm_b, grid=TRUE,full=TRUE,se.fit=TRUE,
type="haz")
newdata1 <- data.frame(female=females[1],year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0)
plot(fpm_b,newdata=newdata1, type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 + agegrp2 + agegrp3 + agegrp4, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
##(b) fit flexible parametric model
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 + agegrp, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
agegrps <- levels(melanoma$agegrp)
agegrps[1]
newdata1 <- data.frame(female=0, year8594=0, agegrps[1])
plot(fpm_b, newdata = newdata1, type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
View(newdata1)
melanoma$agegrp
newdata1 <- data.frame(female="0", year8594="0", agegrps[1])
plot(fpm_b, newdata = newdata1, type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
females <- levels(melanoma$female)
years <- levels(melanoma$year8594)
females
years
females[1]
years[1]
newdata1 <- data.frame(female=females[1], year8594=years[1], agegrps[1])
plot(fpm_b, newdata = newdata1, type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
agegrps[1]
eform(fpm_b)
## Exercise 131
## Created: 2021-06-21 Enoch Chen
## Edited:  2021-07-02 Enoch Chen
## Reference: Biostatistics III in R. https://biostat3.net/download/R/solutions/q28.html
###############################################################################
## Load the packages
library(biostat3)
library(haven)
library(dplyr)   # manipulate data
library(rstpm2)  # nsx
library(ggplot2) # ggplot
## Read data
melanoma <- read_dta("melanoma.dta")%>%
filter(stage == 1) %>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
female = ifelse(sex == 2, 1, 0), # Create a female variable
event  = ifelse((status == 1) & surv_mm<= 120.5, 1, 0), # Redefine status
surv_mm = ifelse(surv_mm<= 120.5, surv_mm, 120.5),     # censored everyone after 120 months
t = surv_mm/12,                                     # surv_mm in years
agegrp1 = (agegrp== 0)+0, # used by time-dependent effect
agegrp2 = (agegrp== 1)+0, # used by time-dependent effect
agegrp3 = (agegrp== 2)+0, # used by time-dependent effect
agegrp4 = (agegrp== 3)+0) # used by time-dependent effect
## Load the packages
library(biostat3)
library(haven)
library(dplyr)   # manipulate data
library(rstpm2)  # nsx
library(ggplot2) # ggplot
## Read data
melanoma <- read_dta("melanoma.dta")%>%
filter(stage == 1) %>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
female = ifelse(sex == 2, 1, 0), # Create a female variable
event  = ifelse((status == 1) & surv_mm<= 120.5, 1, 0), # Redefine status
surv_mm = ifelse(surv_mm<= 120.5, surv_mm, 120.5),     # censored everyone after 120 months
t = surv_mm/12,                                     # surv_mm in years
agegrp1 = (agegrp== 0)+0, # used by time-dependent effect
agegrp2 = (agegrp== 1)+0, # used by time-dependent effect
agegrp3 = (agegrp== 2)+0, # used by time-dependent effect
agegrp4 = (agegrp== 3)+0) # used by time-dependent effect
melanoma <- melanoma %>%
mutate(year8594 = as_factor(year8594),
female = as_factor(female),
agegrp = as_factor(agegrp),
agegrp1 = as_factor(agegrp1),
agegrp2 = as_factor(agegrp2),
agegrp3 = as_factor(agegrp3),
agegrp4 = as_factor(agegrp4))
str(melanoma)
fpm_f <- stpm2(Surv(t, event) ~ year8594, data = melanoma, df=4)
summary(fpm_f)
eform(fpm_f)
years <- levels(as.factor(melanoma$year8594))
## Hazard function
plot(fpm_f,newdata=data.frame(year8594=years[1]), type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per py)")
lines(fpm_f,newdata=data.frame(year8594=years[2]), type="haz", col=2)
legend("topright", legend=years, col=1:2, lty=1, bty="n")
newdata1 <- expand.grid(female=females[1], year8594=years[1], agegrps[1])
###############################################################################
## Load the packages
library(biostat3)
library(haven)
library(dplyr)   # manipulate data
library(rstpm2)
library(ggplot2) # ggplot
## Read data
melanoma <- read_dta("melanoma.dta")%>%
filter(stage == 1) %>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
female = ifelse(sex == 2, 1, 0), # Create a female variable
event  = ifelse((status == 1) & surv_mm<= 60.5, 1, 0), # Redefine status
surv_mm = ifelse(surv_mm<= 60.5, surv_mm, 60.5),       # censored everyone after 60 months
t = surv_mm/12,                                     # surv_mm in years
agegrp1 = (agegrp== 0)+0, # used by time-dependent effect
agegrp2 = (agegrp== 1)+0, # used by time-dependent effect
agegrp3 = (agegrp== 2)+0, # used by time-dependent effect
agegrp4 = (agegrp== 3)+0) # used by time-dependent effect
melanoma <- melanoma %>%
mutate(year8594 = as_factor(year8594),
female = as_factor(female),
agegrp = as_factor(agegrp),
agegrp1 = as_factor(agegrp1),
agegrp2 = as_factor(agegrp2),
agegrp3 = as_factor(agegrp3),
agegrp4 = as_factor(agegrp4))
str(melanoma)
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 + agegrp, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
females <- levels(melanoma$female)
years <- levels(melanoma$year8594)
agegrps <- levels(melanoma$agegrp)
newdata1 <- expand.grid(female=females[1], year8594=years[1], agegrps[1])
h_M_7584_age44 <- predict(fpm_b, newdata = new.data1, type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
new.data1 <- expand.grid(female=females[1], year8594=years[1], agegrps[1])
h_M_7584_age44 <- predict(fpm_b, newdata = new.data1, type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
melanoma <- read_dta("melanoma.dta")%>%
filter(stage == 1)
View(melanoma)
melanoma <- read_dta("melanoma.dta")%>%
filter(stage == 1) %>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
female = ifelse(sex == 2, 1, 0), # Create a female variable
event  = ifelse((status == 1) & surv_mm<= 60.5, 1, 0), # Redefine status
surv_mm = ifelse(surv_mm<= 60.5, surv_mm, 60.5),       # censored everyone after 60 months
t = surv_mm/12,                                     # surv_mm in years
agegrp1 = (agegrp== 0), # used by time-dependent effect
agegrp2 = (agegrp== 1), # used by time-dependent effect
agegrp3 = (agegrp== 2), # used by time-dependent effect
agegrp4 = (agegrp== 3)) # used by time-dependent effect
View(melanoma)
melanoma <- read_dta("melanoma.dta")%>%
filter(stage == 1) %>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
female = ifelse(sex == 2, 1, 0), # Create a female variable
event  = ifelse((status == 1) & surv_mm<= 60.5, 1, 0), # Redefine status
surv_mm = ifelse(surv_mm<= 60.5, surv_mm, 60.5),       # censored everyone after 60 months
t = surv_mm/12,                                     # surv_mm in years
agegrp1 = (agegrp== 0)+0, # used by time-dependent effect
agegrp2 = (agegrp== 1)+0, # used by time-dependent effect
agegrp3 = (agegrp== 2)+0, # used by time-dependent effect
agegrp4 = (agegrp== 3)+0) # used by time-dependent effect
View(new.data1)
View(melanoma)
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 + agegrp2 + agegrp3 + agegrp4, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
new.data1 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0)
h_M_7584_age44 <- predict(fpm_b, newdata = new.data1, type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
## Read data
melanoma <- read_dta("melanoma.dta")%>%
filter(stage == 1) %>%
mutate(year8594 = ifelse(year8594 == 1, "Diagnosed 85-94", "Diagnosed 75-84"),
female = ifelse(sex == 2, 1, 0), # Create a female variable
event  = ifelse((status == 1) & surv_mm<= 60.5, 1, 0), # Redefine status
surv_mm = ifelse(surv_mm<= 60.5, surv_mm, 60.5),       # censored everyone after 60 months
t = surv_mm/12,                                     # surv_mm in years
agegrp1 = (agegrp== 0)+0, # used by time-dependent effect
agegrp2 = (agegrp== 1)+0, # used by time-dependent effect
agegrp3 = (agegrp== 2)+0, # used by time-dependent effect
agegrp4 = (agegrp== 3)+0) # used by time-dependent effect
melanoma <- melanoma %>%
mutate(year8594 = as_factor(year8594),
female = as_factor(female),
agegrp = as_factor(agegrp))
str(melanoma)
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 + agegrp2 + agegrp3 + agegrp4, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
females <- levels(melanoma$female)
years <- levels(melanoma$year8594)
new.data1 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0)
h_M_7584_age44 <- predict(fpm_b, newdata = new.data1, type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
plot(fpm_b, newdata = newdata1, type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
plot(h_M_7584_age44, newdata = newdata1, type="haz", ci=FALSE,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
plot(h_M_7584_age44,
xlab="Time since diagnosis (years)", ylab="Cause-specific mortality rate (per 1000 pys)")
h_agegrp1 <- predict(fpm_b, newdata = new.data1, type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
View(h_M_7584_age44)
ggplot(h_agegrp1, aes(x=t,y=Estimate)) +
xlab("Time since diagnosis (years)") +
ylab("Cause-specific mortality rate (per 1000 pys)") +
geom_line()
ggplot(h_agegrp1, aes(x=t,y=Estimate)) +
xlab("Time since diagnosis (years)") +
ylab("Cause-specific mortality rate (per pys)") +
geom_line()
h_agegrp1 <- predict(fpm_b, newdata = data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0), type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
h_agegrp2 <- predict(fpm_b, newdata = data.frame(female=females[1], year8594=years[1], agegrp2=1, agegrp3=0, agegrp4=0), type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
h_agegrp3 <- predict(fpm_b, newdata = data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=1, agegrp4=0), type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
h_agegrp3 <- predict(fpm_b, newdata = data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=1), type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
geom_line(h_agegrp2, aes(x=t,y=Estimate))
ggplot(h_agegrp1, aes(x=t,y=Estimate)) +
xlab("Time since diagnosis (years)") +
ylab("Cause-specific mortality rate (per pys)") +
geom_line() +
geom_line(h_agegrp2, aes(x=t,y=Estimate))
ggplot(h_agegrp1, aes(x=t,y=Estimate)) +
xlab("Time since diagnosis (years)") +
ylab("Cause-specific mortality rate (per pys)") +
geom_line() +
geom_line(data=h_agegrp2, aes(x=t,y=Estimate))
ggplot(h_agegrp1, aes(x=t,y=Estimate)) +
xlab("Time since diagnosis (years)") +
ylab("Cause-specific mortality rate (per pys)") +
geom_line() +
geom_line(data=h_agegrp2, aes(x=t,y=Estimate))+
geom_line(data=h_agegrp3, aes(x=t,y=Estimate))+
geom_line(data=h_agegrp4, aes(x=t,y=Estimate))
h_agegrp1 <- predict(fpm_b, newdata = data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0), type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
h_agegrp2 <- predict(fpm_b, newdata = data.frame(female=females[1], year8594=years[1], agegrp2=1, agegrp3=0, agegrp4=0), type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
h_agegrp3 <- predict(fpm_b, newdata = data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=1, agegrp4=0), type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
h_agegrp4 <- predict(fpm_b, newdata = data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=1), type = "haz", grid=TRUE, full = TRUE, se.fit = TRUE)
ggplot(h_agegrp1, aes(x=t,y=Estimate)) +
xlab("Time since diagnosis (years)") +
ylab("Cause-specific mortality rate (per pys)") +
geom_line() +
geom_line(data=h_agegrp2, aes(x=t,y=Estimate))+
geom_line(data=h_agegrp3, aes(x=t,y=Estimate))+
geom_line(data=h_agegrp4, aes(x=t,y=Estimate))
agegrps
ggplot(h_agegrp1, aes(x=t,y=Estimate)) +
xlab("Time since diagnosis (years)") +
ylab("Cause-specific mortality rate (per pys)") +
geom_line() +
geom_line(data=h_agegrp2, aes(x=t,y=Estimate), color="red")+
geom_line(data=h_agegrp3, aes(x=t,y=Estimate), color="green")+
geom_line(data=h_agegrp4, aes(x=t,y=Estimate), color="blue")+
theme(legend.position="top")
ggplot(h_agegrp1, aes(x=t,y=Estimate)) +
xlab("Time since diagnosis (years)") +
ylab("Cause-specific mortality rate (per pys)") +
geom_line() +
geom_line(data=h_agegrp2, aes(x=t,y=Estimate), color="red")+
geom_line(data=h_agegrp3, aes(x=t,y=Estimate), color="green")+
geom_line(data=h_agegrp4, aes(x=t,y=Estimate), color="blue")+
theme(legend.position="top")+
scale_fill_discrete(labels=c("0-44", "45-59", "60-74","75+"))
ggplot(h_agegrp1, aes(x=t,y=Estimate)) +
xlab("Time since diagnosis (years)") +
ylab("Cause-specific mortality rate (per pys)") +
geom_line() +
geom_line(data=h_agegrp2, aes(x=t,y=Estimate), color="red")+
geom_line(data=h_agegrp3, aes(x=t,y=Estimate), color="green")+
geom_line(data=h_agegrp4, aes(x=t,y=Estimate), color="blue")+
theme(legend.position="top")+
scale_fill_manual(labels=c("0-44", "45-59", "60-74","75+"))
plot(h_agegrp1, xlab="Time since diagnosis (years)",
type="hr",var="agegrp2", ci=FALSE, ylim=c(0,6))
plot(h_agegrp1)
plot(h_agegrp1, newdata=newdata = data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0), xlab="Time since diagnosis (years)",
type="hr",var="agegrp2", ci=FALSE)
plot(h_agegrp1, newdata=newdata = data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0), xlab="Time since diagnosis (years)",
type="hr",ci=FALSE)
plot(fpm_b, newdata=newdata = data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0),
xlab="Time since diagnosis (years)",
type="hr",ci=FALSE)
plot(fpm_b, newdata=newdata = data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0),
xlab="Time since diagnosis (years)",
type="hr", ci=FALSE)
lines(fpmh, newdata=newdata1, type="hr", var="agegrp3", lty=2)
plot(fpm_b, newdata=data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0),
xlab="Time since diagnosis (years)",
type="hr", ci=FALSE)
plot(fpm_b, newdata=data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0),
xlab="Time since diagnosis (years)",
type="haz", ci=FALSE)
newdata1 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0)
newdata2 <- data.frame(female=females[1], year8594=years[1], agegrp2=1, agegrp3=0, agegrp4=0)
newdata3 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=1, agegrp4=0)
newdata4 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=1)
plot(fpm_b, newdata=newdata1,
xlab="Time since diagnosis (years)",
type="haz", ci=FALSE)
lines(fpm_b, newdata=newdata2, type="haz", lty=2)
lines(fpm_b, newdata=newdata3, type="haz", lty=3)
lines(fpm_b, newdata=newdata4, type="haz", lty=3)
plot(fpm_b, newdata=newdata1,
xlab="Time since diagnosis (years)",
type="haz", ci=FALSE, ylim=c(0,0.2))
lines(fpm_b, newdata=newdata2, type="haz", lty=2)
lines(fpm_b, newdata=newdata3, type="haz", lty=3)
lines(fpm_b, newdata=newdata4, type="haz", lty=3)
agegrps <- levels(melanoma$agegrp)
legend("topright", legend=paste0(agegrps), lty=1:4)
## Hazard function
females <- levels(melanoma$female)
years <- levels(melanoma$year8594)
agegrps <- levels(melanoma$agegrp)
newdata1 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0)
newdata2 <- data.frame(female=females[1], year8594=years[1], agegrp2=1, agegrp3=0, agegrp4=0)
newdata3 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=1, agegrp4=0)
newdata4 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=1)
plot(fpm_b, newdata=newdata1,
xlab="Time since diagnosis (years)",
type="haz", ci=FALSE, ylim=c(0,0.2))
lines(fpm_b, newdata=newdata2, type="haz", lty=2)
lines(fpm_b, newdata=newdata3, type="haz", lty=3)
lines(fpm_b, newdata=newdata4, type="haz", lty=4)
legend("topright", legend=paste0(agegrps), lty=1:4)
source("~/cansurv_r/solutions/q132.R")
plot(fpm_b, newdata=newdata1,
xlab="Time since diagnosis (years)",
ylab="Cause specific mortality rate (per pys)",
type="haz", ci=FALSE, ylim=c(0,0.2))
lines(fpm_b, newdata=newdata2, type="haz", lty=2)
lines(fpm_b, newdata=newdata3, type="haz", lty=3)
lines(fpm_b, newdata=newdata4, type="haz", lty=4)
legend("topright", legend=paste0(agegrps), lty=1:4)
source("~/cansurv_r/solutions/q132.R")
##(b) fit flexible parametric model
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 + agegrp2 + agegrp3 + agegrp4, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
## Hazard function
females <- levels(melanoma$female)
years <- levels(melanoma$year8594)
agegrps <- levels(melanoma$agegrp)
newdata1 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0)
newdata2 <- data.frame(female=females[1], year8594=years[1], agegrp2=1, agegrp3=0, agegrp4=0)
newdata3 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=1, agegrp4=0)
newdata4 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=1)
plot(fpm_b, newdata=newdata1,
xlab="Time since diagnosis (years)",
ylab="Cause specific mortality rate (per pys)",
type="haz", ci=FALSE, ylim=c(0,0.2))
lines(fpm_b, newdata=newdata2, type="haz", lty=2)
lines(fpm_b, newdata=newdata3, type="haz", lty=3)
lines(fpm_b, newdata=newdata4, type="haz", lty=4)
legend("topright", legend=paste0(agegrps), lty=1:4)
##(b) fit flexible parametric model
fpm_b <- stpm2(Surv(t, event) ~ female + year8594 + agegrp2 + agegrp3 + agegrp4, data = melanoma, df=4)
summary(fpm_b)
eform(fpm_b)
## Hazard function
females <- levels(melanoma$female)
years <- levels(melanoma$year8594)
agegrps <- levels(melanoma$agegrp)
newdata1 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=0)
newdata2 <- data.frame(female=females[1], year8594=years[1], agegrp2=1, agegrp3=0, agegrp4=0)
newdata3 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=1, agegrp4=0)
newdata4 <- data.frame(female=females[1], year8594=years[1], agegrp2=0, agegrp3=0, agegrp4=1)
plot(fpm_b, newdata=newdata1,
xlab="Time since diagnosis (years)",
ylab="Cause specific mortality rate (per pys)",
type="haz", ci=FALSE, ylim=c(0,0.2))
lines(fpm_b, newdata=newdata2, type="haz", lty=2)
lines(fpm_b, newdata=newdata3, type="haz", lty=3)
lines(fpm_b, newdata=newdata4, type="haz", lty=4)
legend("topright", legend=paste0(agegrps), lty=1:4)
