library(biostat3)
##
melanoma <- data(melanoma)
head(melanoma)
library(biostat3)
library(dplyr)
data(melanoma)
force(melanoma)
getwd()
melanoma <- read_dta(./data/melanoma.dta)
library(haven)
melanoma <- read_dta("./data/melanoma.dta")
melanoma <- read_dta("/data/melanoma.dta")
melanoma <- read_dta("~/data/melanoma.dta")
getwd()
melanoma <- read_dta("~/~/data/melanoma.dta")
melanoma <- read_dta("melanoma.dta")
melanoma <- data(melanoma)
melanoma <- data(biostat3::melanoma)
library(biostat3)
melanoma <- data(melanoma)
data(melanoma)
melanoma <- read_dta("melanoma.dta")
data(melanoma)
data(melanoma)
data(melanoma)
library(biostat3)
library(dplyr)
library(haven)
data(melanoma)
melanoma <- read_dta("melanoma.dta")
View(melanoma)
melanoma <- transform(melanoma,
csr_fail = ifelse( status == 1, 1, 0))
View(melanoma)
print(lifetab2(Surv(floor(surv_yy), status == 1)~1, melanoma, breaks=0:10), digits=2)
print(lifetab2(Surv(floor(surv_mm), status == 1)~1, melanoma, breaks=c(12*(0:10))), digits=2)
print(lifetab2(Surv(floor(surv_mm), status == 1)~1, melanoma, breaks=c(12*(0:20))), digits=2)
mfit <- survfit(Surv(surv_mm, status == "Dead: cancer") ~ 1, data = colon_sample)
summary(mfit)
mfit <- survfit(Surv(surv_mm, status == 1) ~ 1, data = melanoma)
summary(mfit)
mfit <- survfit(Surv(surv_yy, status == 1) ~ 1, data = melanoma)
summary(mfit)
mfit2 <- survfit(Surv(surv_mm, status == 1) ~ 1, data = melanoma)
summary(mfit2)
source('~/cansurv_r/solutions/r/q102.R', echo=TRUE)
## Exercise 103
## Created: 2021-03-04 Enoch Chen
## Edited:  2021-03-04 Enoch Chen
###############################################################################
## Load the packages
library(biostat3)
library(dplyr)
library(haven)
## Read data
melanoma <- read_dta("melanoma.dta")
#' Vital status (status) is coded as follows
#' 1 [Dead: cancer]
#' 2 [Dead: other]
#' 0 [Alive]
#' 4 [Lost to follow-up]
## Exercise 103
## Created: 2021-03-04 Enoch Chen
## Edited:  2021-03-04 Enoch Chen
###############################################################################
## Load the packages
library(biostat3)
library(dplyr)
library(haven)
## Read data
melanoma <- read_dta("melanoma.dta")
#' Vital status (status) is coded as follows
#' 1 [Dead: cancer]
#' 2 [Dead: other]
#' 0 [Alive]
#' 4 [Lost to follow-up]
Freq <- xtabs(~stage, data=melanoma)
cbind(Freq, Prop=prop.table(Freq))
## Load the packages
library(biostat3)
library(dplyr)
library(haven)
## Read data
melanoma <- read_dta("melanoma.dta")
#' stage (Clinical stage at diagnosis) is coded as follows
#' 0 [Unknown]
#' 1 [Localised]
#' 2 [Regional]
#' 3 [Distant]
## Tabulate stage distribution
Freq <- xtabs(~stage, data=melanoma)
cbind(Freq, Prop=prop.table(Freq))
cbind(Freq, Prop=prop.table(Freq, digits = 2))
cbind(Freq, Prop=prop.table(Freq) %>% `*`(100) %>% round(2))
cbind(Freq, Percent=prop.table(Freq) %>% `*`(100) %>% round(2))
par(mfrow=c(1, 2)) # Will plot 2 graphs
mfit <- survfit(Surv(surv_mm, death_cancer) ~ stage, data = melanoma)
mfit <- survfit(Surv(surv_mm, status == 1) ~ stage, data = melanoma)
par(mfrow=c(1, 2)) # Will plot 2 graphs
mfit <- survfit(Surv(surv_mm, status == 1) ~ stage, data = melanoma)
plot(mfit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival")
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
## Hazard
hazards <- muhaz2(Surv(surv_mm, status == 1)~stage, melanoma)
plot(hazards,
col=1:4, lty=1, xlim=c(0,250), ylim=c(0,0.08),
legend.args=list(bty="n"))
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
plot(mfit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival", legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
legend("topright", levels(melanoma$stage), col=1:4, lty = 1))
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
legend("topright", legend(levels(melanoma$stage)), col=1:4, lty = 1)
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
plot(mfit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival")
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
legend("topright", legend = levels((melanoma$stage)), col=1:4, lty = 1)
legend("topright", legend = levels(melanoma$stage), col=1:4, lty = 1)
legend("topright", legend = c(levels(melanoma$stage)), col=1:4, lty = 1)
legend("topright", legend = levels(melanoma$stage), col=1:4, lty = 1)
legend("topright", legend = levels(melanoma$stage))
plot(hazards,
col=1:4, lty=1, xlim=c(0,250), ylim=c(0,0.08),
legend.args=list(bty="n"))
## Hazard
hazards <- muhaz2(Surv(surv_mm, status == 1)~stage, melanoma)
plot(hazards,
col=1:4, lty=1, xlim=c(0,250), ylim=c(0,0.08),
legend.args=list(bty="n"))
plot(mfit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival")
par(mfrow=c(1, 2)) # Will plot 2 graphs
mfit <- survfit(Surv(surv_mm, status == 1) ~ stage, data = melanoma)
plot(mfit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival")
## Hazard
hazards <- muhaz2(Surv(surv_mm, status == 1)~stage, melanoma)
plot(hazards,
col=1:4, lty=1, xlim=c(0,250), ylim=c(0,0.08),
legend.args=list(bty="n"))
survRate(mfit)
survRate(Surv(surv_mm, status == 1) ~ stage, data = melanoma)
survRate(Surv(surv_mm/12, status == 1) ~ stage, data = melanoma)
survRate(Surv(surv_yy, status == 1) ~ stage, data = melanoma)
par(mfrow=c(1, 2)) # Will plot 2 graphs
mfit <- survfit(Surv(surv_mm, status == 1) ~ sex, data = melanoma)
plot(mfit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival")
## Hazard
hazards <- muhaz2(Surv(surv_mm, status == 1)~ sex, melanoma)
plot(hazards,
col=1:4, lty=1, xlim=c(0,250), ylim=c(0,0.08),
legend.args=list(bty="n"))
par(mfrow=c(1, 2)) # Will plot 2 graphs
mfit <- survfit(Surv(surv_mm, status == 1) ~ sex, data = melanoma)
plot(mfit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival")
## Hazard
hazards <- muhaz2(Surv(surv_mm, status == 1)~ sex, melanoma)
plot(hazards,
col=1:4, lty=1, xlim=c(0,250), ylim=c(0,0.08),
legend.args=list(bty="n"))
par(mfrow=c(1, 2)) # Will plot 2 graphs
mfit <- survfit(Surv(surv_mm, status == 1) ~ sex, data = melanoma)
plot(mfit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival")
## Hazard
hazards <- muhaz2(Surv(surv_mm, status == 1)~ sex, melanoma)
plot(hazards,
col=1:2, lty=1)
survRate(Surv(surv_mm/12/1000, status == 1) ~ sex, data=melanoma)
xtabs(~status+agegrp, melanoma)
xtabs(~status+agegrp, melanoma)
xtabs(~status+agegrp, melanoma)
par(mfrow=c(1, 1))
afit <- survfit(Surv(surv_mm, death_all) ~ stage, data = melanoma)
plot(afit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nAll-cause")
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
par(mfrow=c(1, 1))
afit <- survfit(Surv(surv_mm, death_all) ~ stage, data = melanoma)
plot(afit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nAll-cause")
## All-cause survival by stage
par(mfrow=c(1, 1))
afit <- survfit(Surv(surv_mm, death_all) ~ stage, data = melanoma)
plot(afit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nAll-cause")
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
afit <- survfit(Surv(surv_mm, death_all) ~ stage, data = melanoma)
afit <- survfit(Surv(surv_mm, status == 1 2) ~ stage, data = melanoma)
afit <- survfit(Surv(surv_mm, status == 1, 2) ~ stage, data = melanoma)
afit <- survfit(Surv(surv_mm, status == 1|2) ~ stage, data = melanoma)
View(afit)
plot(afit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nAll-cause")
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
legend("topright", legend=levels(melanoma$stage), col=1:4, lty = 1)
legend("topright", legend=(levels(melanoma$stage)), col=1:4, lty = 1)
legend("topright", legend=c(levels(melanoma$stage)), col=1:4, lty = 1)
levels(melanoma$stage)
View(melanoma)
melanoma$stage
levels(melanoma$stage)
legend("topright", legend=c(levels(as.factor(melanoma$stage))), col=1:4, lty = 1)
afit <- survfit(Surv(surv_mm, status == 1|status == 2) ~ stage, data = melanoma)
plot(afit, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nAll-cause")
legend("topright", legend=c(levels(as.factor(melanoma$stage))), col=1:4, lty = 1)
par(mfrow=c(1, 2))
mfit75 <- survfit(Surv(surv_mm, death_cancer) ~ stage, data = subset(melanoma,agegrp=="75+"))
plot(mfit75, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nCancer | Age 75+")
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
afit75 <- survfit(Surv(surv_mm, death_all) ~ stage, data = subset(melanoma,agegrp=="75+"))
plot(afit75, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nAll-cause | Age 75+")
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
par(mfrow=c(1, 2))
mfit75 <- survfit(Surv(surv_mm, status == 1) ~ stage, data = subset(melanoma,agegrp=="75+"))
plot(mfit75, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nCancer | Age 75+")
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
afit75 <- survfit(Surv(surv_mm, status == 1|status == 2) ~ stage, data = subset(melanoma,agegrp=="75+"))
plot(afit75, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nAll-cause | Age 75+")
legend("topright", levels(melanoma$stage), col=1:4, lty = 1)
par(mfrow=c(1, 2))
mfit75 <- survfit(Surv(surv_mm, status == 1) ~ stage, data = subset(melanoma,agegrp=="75+"))
plot(mfit75, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nCancer | Age 75+")
legend("topright", legend=c(levels(as.factor(melanoma$stage))), col=1:4, lty = 1)
afit75 <- survfit(Surv(surv_mm, status == 1|status == 2) ~ stage, data = subset(melanoma,agegrp=="75+"))
plot(afit75, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nAll-cause | Age 75+")
legend("topright", legend=c(levels(as.factor(melanoma$stage))), col=1:4, lty = 1)
par(mfrow=c(1, 2))
mfit75 <- survfit(Surv(surv_mm, status == 1) ~ stage, data = subset(melanoma,agegrp=="75+"))
plot(mfit75, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nCancer | Age 75+")
legend("topright", legend=c(levels(as.factor(melanoma$stage))), col=1:4, lty = 1)
par(mfrow=c(1, 2))
mfit75 <- survfit(Surv(surv_mm, status == 1) ~ stage, data = subset(melanoma,agegrp=="75+"))
plot(mfit75, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nCancer | Age 75+")
legend("topright", legend=c(levels(as.factor(melanoma$stage))), col=1:4, lty = 1)
mfit75 <- survfit(Surv(surv_mm, status == 1) ~ stage, data = subset(melanoma,agegrp=="75+"))
par(mfrow=c(1, 2))
mfit75 <- survfit(Surv(surv_mm, status == 1) ~ stage, data = subset(melanoma,agegrp==3))
plot(mfit75, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nCancer | Age 75+")
legend("topright", legend=c(levels(as.factor(melanoma$stage))), col=1:4, lty = 1)
afit75 <- survfit(Surv(surv_mm, status == 1|status == 2) ~ stage, data = subset(melanoma,agegrp==3))
plot(afit75, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier survival estimates\nAll-cause | Age 75+")
legend("topright", legend=c(levels(as.factor(melanoma$stage))), col=1:4, lty = 1)
melanoma M- data("melanoma")
melanoma <- data("melanoma")
melanoma <- data("biostat3::melanoma")
melanoma <- data(biostat3::melanoma)
melanoma <- data(biostat3:melanoma)
par(mfrow=c(1, 2))
mfitage <- survfit(Surv(surv_mm, status == 1) ~ agegrp, data = melanoma)
plot(mfitage, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier estimates of\ncancer survival by age group")
legend("topright", legend=c(levels(as.factor(melanoma$agegrp))), col=1:4, lty = 1)
afitage <- survfit(Surv(surv_mm, status == 1|status == 2) ~ agegrp, data = melanoma)
plot(afitage, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier estimates of\nall-cause survival by age group")
legend("topright", legend=c(levels(as.factor(melanoma$agegrp))), col=1:4, lty = 1)
par(mfrow=c(1, 2))
mfitage <- survfit(Surv(surv_mm, status == 1) ~ agegrp, data = melanoma)
plot(mfitage, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier estimates of\ncancer survival by age group")
legend("topright", legend=c(levels(as.factor(melanoma$agegrp))), col=1:4, lty = 1)
mfitage <- survfit(Surv(surv_mm, status == 1) ~ agegrp, data = melanoma)
melanoma <- read_dta("melanoma.dta")
par(mfrow=c(1, 2))
mfitage <- survfit(Surv(surv_mm, status == 1) ~ agegrp, data = melanoma)
plot(mfitage, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier estimates of\ncancer survival by age group")
legend("topright", legend=c(levels(as.factor(melanoma$agegrp))), col=1:4, lty = 1)
par(mfrow=c(1, 2))
mfitage <- survfit(Surv(surv_mm, status == 1) ~ agegrp, data = melanoma)
plot(mfitage, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier estimates of\ncancer survival by age group")
legend("bottomright", legend=c(levels(as.factor(melanoma$agegrp))), col=1:4, lty = 1)
afitage <- survfit(Surv(surv_mm, status == 1|status == 2) ~ agegrp, data = melanoma)
plot(afitage, col=1:4,
xlab = "Follow-up Time",
ylab = "Survival",
main = "Kaplan-Meier estimates of\nall-cause survival by age group")
legend("topright", legend=c(levels(as.factor(melanoma$agegrp))), col=1:4, lty = 1)
source('~/cansurv_r/solutions/r/q103.R', echo=TRUE)
source('~/cansurv_r/solutions/r/q103.R', echo=TRUE)
source('~/cansurv_r/solutions/r/q103.R', echo=TRUE)
